{"version":3,"sources":["../../src/controllers/events.js"],"names":["asyncHandler","addEvent","req","res","dateStart","setTime","getTime","Date","getTimezoneOffset","data","start","dateEnd","end","Event","findOne","$and","location","latLng","lng","lat","$gte","$lte","existingEvent","status","json","success","message","make","then","event","catch","err","console","log","getAllEvents","see","events"],"mappings":";;;;;;;;kBAAe,gBAAoB;AAAA,KAAlBA,YAAkB,QAAlBA,YAAkB;;AAClC,KAAMC;AAAA,sEAAW,iBAAOC,GAAP,EAAYC,GAAZ;AAAA;AAAA;AAAA;AAAA;AAAA;;AAEhBC,iBAAUC,OAAV,CACED,UAAUE,OAAV,KAAsB,IAAIC,IAAJ,GAAWC,iBAAX,KAAiC,EAAjC,GAAsC,IAD9D;AAGAC,YAAKC,KAAL,GAAaN,SAAb;;AAEMO,cAPU,GAOA,IAAIJ,IAAJ,CAASE,KAAKG,GAAd,CAPA;;AAQhBD,eAAQN,OAAR,CACEM,QAAQL,OAAR,KAAoB,IAAIC,IAAJ,GAAWC,iBAAX,KAAiC,EAAjC,GAAsC,IAD5D;;AAIAC,YAAKG,GAAL,GAAWD,OAAX;AAZgB;AAAA,cAaYE,MAAMC,OAAN,CAAc;AACxCC,cAAM,CACP;AACE,gCAAuBN,KAAKO,QAAL,CAAcC,MAAd,CAAqBC,GAD9C;AAEE,gCAAuBT,KAAKO,QAAL,CAAcC,MAAd,CAAqBE;AAF9C,SADO,EAKP;AACEJ,eAAM,CAAC,EAAEL,OAAO,EAAEU,MAAMX,KAAKC,KAAb,EAAT,EAAD,EAAkC,EAAEE,KAAK,EAAES,MAAMZ,KAAKG,GAAb,EAAP,EAAlC;AADR,SALO;AADkC,QAAd,CAbZ;;AAAA;AAaVU,oBAbU;;;AA2BhB,WAAIA,aAAJ,EAAmB;AACjBnB,YAAIoB,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AACtBC,kBAAS,KADa;AAEtBC,kBAAS;AAFa,SAArB;AAID,QALD,MAKO;AACLb,cAAMc,IAAN,CAAWlB,IAAX,EACAmB,IADA,CACK,UAACC,KAAD,EAAW;AACf1B,aAAIoB,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AACtBC,mBAAS,IADa;AAEtBI;AAFsB,UAArB;AAID,SANA,EAOAC,KAPA,CAOM,UAACC,GAAD,EAAS;AACdC,iBAAQC,GAAR,CAAYF,GAAZ;AACA5B,aAAIoB,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AACtBC,mBAAS,KADa;AAEtBC,mBAAS;AAFa,UAArB;AAID,SAbA;AAcD;;AA/Ce;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAX;;AAAA;AAAA;AAAA;AAAA,IAAN;;AAkDA,KAAMQ;AAAA,sEAAe,kBAAOhC,GAAP,EAAYC,GAAZ;AAAA;AAAA;AAAA;AAAA;AACpBU,aAAMsB,GAAN,CAAU,EAAV,EACGP,IADH,CACQ,UAACQ,MAAD,EAAY;AACnBjC,YAAIqB,IAAJ,CAAS,EAAEC,SAAS,IAAX,EAAiBW,cAAjB,EAAT;AACE,QAHH,EAIGN,KAJH,CAIS,UAACC,GAAD,EAAS;AACjBC,gBAAQC,GAAR,CAAYF,GAAZ;AACA5B,YAAIoB,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AACnBC,kBAAS,KADU;AAEnBC,kBAAS;AAFU,SAArB;AAIE,QAVH;;AADoB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAf;;AAAA;AAAA;AAAA;AAAA,IAAN;;AAcA,QAAO;AACNzB,YAAUD,aAAaC,QAAb,CADJ;AAENiC,gBAAclC,aAAakC,YAAb;AAFR,EAAP;AAIA,C","file":"events.js","sourcesContent":["export default ({asyncHandler}) => {\n\tconst addEvent = async (req, res) => {\n\n\t\tdateStart.setTime(\n\t\t  dateStart.getTime() - new Date().getTimezoneOffset() * 60 * 1000,\n\t\t);\n\t\tdata.start = dateStart;\n\t\n\t\tconst dateEnd = new Date(data.end);\n\t\tdateEnd.setTime(\n\t\t  dateEnd.getTime() - new Date().getTimezoneOffset() * 60 * 1000,\n\t\t);\n\t\n\t\tdata.end = dateEnd;\n\t\tconst existingEvent = await Event.findOne({\n\t\t  $and: [\n\t\t\t{\n\t\t\t  'location.latLng.lng': data.location.latLng.lng,\n\t\t\t  'location.latLng.lat': data.location.latLng.lat,\n\t\t\t},\n\t\t\t{\n\t\t\t  $and: [{ start: { $gte: data.start } }, { end: { $lte: data.end } }],\n\t\t\t},\n\t\t  ],\n\t\t});\n\t\n\t\n\t\n\t\tif (existingEvent) {\n\t\t  res.status(500).json({\n\t\t\tsuccess: false,\n\t\t\tmessage: 'An Event already exist at this venue on this day',\n\t\t  });\n\t\t} else {\n\t\t  Event.make(data)\n\t\t\t.then((event) => {\n\t\t\t  res.status(200).json({\n\t\t\t\tsuccess: true,\n\t\t\t\tevent,\n\t\t\t  });\n\t\t\t})\n\t\t\t.catch((err) => {\n\t\t\t  console.log(err);\n\t\t\t  res.status(500).json({\n\t\t\t\tsuccess: false,\n\t\t\t\tmessage: 'An Error Occured, please try again later',\n\t\t\t  });\n\t\t\t});\n\t\t}\n\t}\n\n\tconst getAllEvents = async (req, res) => {\n\t\tEvent.see({})\n\t\t  .then((events) => {\n\t\t\tres.json({ success: true, events });\n\t\t  })\n\t\t  .catch((err) => {\n\t\t\tconsole.log(err);\n\t\t\tres.status(500).json({\n\t\t\t  success: false,\n\t\t\t  message: 'An Error Occured, please try again later',\n\t\t\t});\n\t\t  });\n\t}\n\n\treturn {\n\t\taddEvent: asyncHandler(addEvent),\n\t\tgetAllEvents: asyncHandler(getAllEvents),\n\t}\n}\n"]}